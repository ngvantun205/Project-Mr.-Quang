<Page x:Class="TDEduEnglish.Views.CoursesPageView.CourseWritingPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:TDEduEnglish.Views.CoursesPageView"
      mc:Ignorable="d" 
      d:DesignHeight="740" d:DesignWidth="1200"
      Title="CourseWritingPage">

    <Page.Resources>
        <!-- Modern Card Style -->
        <Style x:Key="ModernCardStyle" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="12"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="Gray" Direction="270" 
                                ShadowDepth="2" BlurRadius="10" Opacity="0.06"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Chat Message Style -->
        <Style x:Key="UserMessageStyle" TargetType="Border">
            <Setter Property="Background" Value="#FF6366F1"/>
            <Setter Property="CornerRadius" Value="12,12,2,12"/>
            <Setter Property="Padding" Value="10,6"/>
            <Setter Property="Margin" Value="50,4,8,4"/>
            <Setter Property="HorizontalAlignment" Value="Right"/>
            <Setter Property="MaxWidth" Value="500"/>
        </Style>

        <Style x:Key="AIMessageStyle" TargetType="Border">
            <Setter Property="Background" Value="#FFF3F4F6"/>
            <Setter Property="CornerRadius" Value="12,12,12,2"/>
            <Setter Property="Padding" Value="10,6"/>
            <Setter Property="Margin" Value="8,4,50,4"/>
            <Setter Property="HorizontalAlignment" Value="Left"/>
            <Setter Property="MaxWidth" Value="600"/>
        </Style>

        <!-- Input Box Style -->
        <Style x:Key="InputBoxStyle" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="Gray" Direction="270" 
                                ShadowDepth="1" BlurRadius="6" Opacity="0.08"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- History Item Style -->
        <Style x:Key="HistoryItemStyle" TargetType="Border">
            <Setter Property="Background" Value="#FFFAFAFA"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Padding" Value="10"/>
            <Setter Property="Margin" Value="0,4"/>
            <Setter Property="BorderBrush" Value="#FFE5E7EB"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#FFF5F5F5"/>
                    <Setter Property="BorderBrush" Value="#FF6366F1"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Tab Style -->
        <Style x:Key="ModernTabStyle" TargetType="TabItem">
            <Setter Property="Foreground" Value="#FF6B7280"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="Margin" Value="0,0,6,0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TabItem">
                        <Border x:Name="Border" Background="Transparent" 
                            BorderThickness="0,0,0,2" BorderBrush="Transparent"
                            CornerRadius="6,6,0,0" Padding="{TemplateBinding Padding}">
                            <ContentPresenter x:Name="ContentSite" 
                                          VerticalAlignment="Center" 
                                          HorizontalAlignment="Center"
                                          ContentSource="Header" 
                                          Margin="0"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Border" Property="BorderBrush" Value="#FF6366F1"/>
                                <Setter Property="Foreground" Value="#FF6366F1"/>
                                <Setter Property="FontWeight" Value="Bold"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#FFF8FAFC"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Button Styles -->
        <Style x:Key="SendButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#FF6366F1"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="Width" Value="32"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                            CornerRadius="16">
                            <ContentPresenter HorizontalAlignment="Center" 
                                          VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#FF5855E8"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#FF4F46E5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="AttachButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#FF6B7280"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="6"/>
            <Setter Property="Width" Value="28"/>
            <Setter Property="Height" Value="28"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                            CornerRadius="14">
                            <ContentPresenter HorizontalAlignment="Center" 
                                          VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#FFF3F4F6"/>
                                <Setter Property="Foreground" Value="#FF6366F1"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="GradeButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#FF10B981"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="10,6"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                            CornerRadius="6" Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" 
                                          VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#FF059669"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#FF047857"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="NewWritingButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#FFEF4444"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="10,6"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                            CornerRadius="6" Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" 
                                          VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#FFDC2626"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#FFB91C1C"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Page.Resources>

    <!-- Background gradient -->
    <Grid>
        <Grid.Background>
            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                <GradientStop Color="#FFF8FAFC" Offset="0"/>
                <GradientStop Color="#FFF1F5F9" Offset="1"/>
            </LinearGradientBrush>
        </Grid.Background>

        <!-- Header Section -->
        <StackPanel VerticalAlignment="Top" Margin="20,12,20,0">
            <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                <Border Background="#FF6366F1" CornerRadius="8" Width="32" Height="32" 
                   Margin="0,0,12,0">
                    <TextBlock Text="✍️" FontSize="16" 
                          HorizontalAlignment="Center" VerticalAlignment="Center"/>
                </Border>
                <StackPanel VerticalAlignment="Center">
                    <TextBlock Text="Writing Skills" FontSize="24" FontWeight="Bold" 
                          Foreground="#FF1F2937"/>
                    <TextBlock Text="Practice your writing and get AI feedback" 
                          FontSize="13" Foreground="#FF6B7280"/>
                </StackPanel>
            </StackPanel>
        </StackPanel>

        <!-- Main Content Area -->
        <Grid Margin="20,72,20,12">
            <!-- Tab Control -->
            <TabControl Background="Transparent" BorderThickness="0">
                <TabControl.Resources>
                    <Style TargetType="TabPanel">
                        <Setter Property="HorizontalAlignment" Value="Left"/>
                        <Setter Property="Margin" Value="0,0,0,12"/>
                    </Style>
                </TabControl.Resources>

                <!-- Chat Tab -->
                <TabItem Header="💬 AI Writing Coach" Style="{StaticResource ModernTabStyle}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*" MinHeight="450"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Top Action Bar -->
                        <Border Grid.Row="0" Background="White" CornerRadius="6" 
                           Padding="10" Margin="0,0,0,8">
                            <Grid>
                                <TextBlock Text="📝 Current Writing Session" FontSize="14" 
                                      FontWeight="SemiBold" Foreground="#FF1F2937" 
                                      VerticalAlignment="Center"/>
                                <Button Content="🆕 New Writing" 
                                   Style="{StaticResource NewWritingButtonStyle}"
                                   HorizontalAlignment="Right"
                                   Command="{Binding CreateNewWritingCommand}"/>
                            </Grid>
                        </Border>

                        <!-- Chat Messages Area -->
                        <Border Grid.Row="1" Style="{StaticResource ModernCardStyle}" Margin="0,0,0,8">
                            <ScrollViewer x:Name="MessagesScrollViewer" 
                  VerticalScrollBarVisibility="Auto" 
                  HorizontalScrollBarVisibility="Disabled"
                  Padding="8">
                                <StackPanel>
                                    <!-- Welcome Message -->
                                    <Border Style="{StaticResource AIMessageStyle}" Margin="8,4,50,4">
                                        <StackPanel Orientation="Horizontal">
                                            <Border Background="#FF6366F1" CornerRadius="16" Width="28" Height="28" 
                            Margin="0,0,8,0" VerticalAlignment="Top">
                                                <TextBlock Text="🤖" FontSize="14" 
                                   HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                            <StackPanel MaxWidth="550">
                                                <TextBlock Text="AI Writing Coach" FontSize="12" FontWeight="SemiBold" 
                                   Foreground="#FF6366F1" Margin="0,0,0,4"/>
                                                <TextBlock Text="Hello! I'm your AI writing coach. Please submit your writing and I'll provide detailed feedback and grading. You can paste your text in the input box below and click 'Grade My Writing' to get started!" 
                                   FontSize="13" Foreground="#FF374151" 
                                   TextWrapping="Wrap" LineHeight="18"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>

                                    <!-- User Writing Submission (when WritingText is not empty) -->
                                    <Border Width="450" Style="{StaticResource UserMessageStyle}" >
                                        <StackPanel Orientation="Horizontal" FlowDirection="RightToLeft">
                                            <Border Background="#FF10B981" CornerRadius="16" Width="28" Height="28" 
                            Margin="8,0,0,0" VerticalAlignment="Top">
                                                <TextBlock Text="✍️" FontSize="14" 
                                   HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                            <StackPanel MaxWidth="450" FlowDirection="LeftToRight">
                                                <TextBlock Text="Your Writing" FontSize="12" FontWeight="SemiBold" 
                                   Foreground="#FF10B981" Margin="0,0,0,4" 
                                   HorizontalAlignment="Right"/>
                                                <TextBlock Width="420" Text="{Binding WritingText, Mode=TwoWay}" 
                                   FontSize="13" Foreground="#FF1F2937" 
                                   TextWrapping="Wrap" LineHeight="18"
                                   Background="#FFECFDF5" Padding="12"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>

                                    <!-- AI Feedback Response (when Content is not empty) -->
                                    <Border Width="580" Style="{StaticResource AIMessageStyle}">
                                        <StackPanel Orientation="Horizontal">
                                            <Border Background="#FF6366F1" CornerRadius="16" Width="28" Height="28" 
                            Margin="0,0,8,0" VerticalAlignment="Top">
                                                <TextBlock Text="📝" FontSize="14" 
                                   HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                            <StackPanel MaxWidth="580">
                                                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                                    <TextBlock Text="AI Feedback &amp; Grade" FontSize="12" FontWeight="SemiBold" 
                                       Foreground="#FF6366F1"/>
                                                    <Border Background="#FF10B981" CornerRadius="12" Padding="6,2" Margin="8,0,0,0">
                                                        <TextBlock Text="✨ Complete" FontSize="10" FontWeight="SemiBold" 
                                           Foreground="White"/>
                                                    </Border>
                                                </StackPanel>

                                                <ScrollViewer MaxHeight="350" VerticalScrollBarVisibility="Auto">
                                                    <TextBlock Text="{Binding Content}" 
                                       FontSize="13" Foreground="#FF374151" 
                                       TextWrapping="Wrap" LineHeight="18"
                                       Background="#FFF8FAFC" Padding="16" 
                                       Width="540"/>
                                                </ScrollViewer>

                                                <!-- Action Buttons for Feedback -->
                                                <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                                    <Button Content="👍 Helpful" Style="{StaticResource AttachButtonStyle}"
                                    Width="Auto" Padding="8,4" FontSize="11" Margin="0,0,6,0"/>
                                                    <Button Content="📋 Copy" Style="{StaticResource AttachButtonStyle}"
                                    Width="Auto" Padding="8,4" FontSize="11" Margin="0,0,6,0"/>
                                                    <Button Content="🔄 Re-grade" Style="{StaticResource AttachButtonStyle}"
                                    Width="Auto" Padding="8,4" FontSize="11"
                                    Command="{Binding GradeWritingCommand}"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>

                                    <!-- Loading State (when grading is in progress) -->
                                    <Border Style="{StaticResource AIMessageStyle}" x:Name="LoadingMessage"
                    Visibility="Collapsed">
                                        <StackPanel Orientation="Horizontal">
                                            <Border Background="#FF6366F1" CornerRadius="16" Width="28" Height="28" 
                            Margin="0,0,8,0" VerticalAlignment="Center">
                                                <TextBlock Text="⏳" FontSize="14" 
                                   HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                            <StackPanel VerticalAlignment="Center">
                                                <TextBlock Text="AI is analyzing your writing..." 
                                   FontSize="13" Foreground="#FF6B7280" 
                                   FontStyle="Italic"/>
                                                <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                                    <Ellipse Width="6" Height="6" Fill="#FF6366F1" Margin="0,0,3,0">
                                                        <Ellipse.RenderTransform>
                                                            <TranslateTransform x:Name="Dot1"/>
                                                        </Ellipse.RenderTransform>
                                                    </Ellipse>
                                                    <Ellipse Width="6" Height="6" Fill="#FF6366F1" Margin="0,0,3,0">
                                                        <Ellipse.RenderTransform>
                                                            <TranslateTransform x:Name="Dot2"/>
                                                        </Ellipse.RenderTransform>
                                                    </Ellipse>
                                                    <Ellipse Width="6" Height="6" Fill="#FF6366F1">
                                                        <Ellipse.RenderTransform>
                                                            <TranslateTransform x:Name="Dot3"/>
                                                        </Ellipse.RenderTransform>
                                                    </Ellipse>
                                                </StackPanel>
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </ScrollViewer>
                        </Border>
                        <!-- Input Area -->
                        <Border Grid.Row="2" Style="{StaticResource InputBoxStyle}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Text Input Area -->
                                <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto" 
                                         MaxHeight="80" Margin="0,0,0,6">
                                    <TextBox x:Name="WritingInputBox"
                                        Text="{Binding WritingText, Mode=TwoWay}"
                                        TextWrapping="Wrap" 
                                        AcceptsReturn="True"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        FontSize="14"
                                        Foreground="#FF9CA3AF"
                                        Padding="4"
                                        MinHeight="60"/>
                                </ScrollViewer>

                                <!-- Action Buttons -->
                                <StackPanel Grid.Row="1" Orientation="Horizontal" 
                                       HorizontalAlignment="Right">

                                    <!-- File Upload Buttons -->
                                    <StackPanel Orientation="Horizontal" Margin="0,0,10,0">
                                        <Button Style="{StaticResource AttachButtonStyle}" 
                                           ToolTip="Take Photo" Margin="0,0,4,0"
                                           Command="{Binding TakePhotoCommand}">
                                            <TextBlock Text="📷" FontSize="12"/>
                                        </Button>

                                        <Button Style="{StaticResource AttachButtonStyle}" 
                                           ToolTip="Upload Document" Margin="0,0,4,0"
                                           Command="{Binding UploadDocumentCommand}">
                                            <TextBlock Text="📎" FontSize="12"/>
                                        </Button>
                                    </StackPanel>

                                    <!-- Grade My Writing Button -->
                                    <Button Content="Grade My Writing" 
                                       Style="{StaticResource GradeButtonStyle}"
                                       Command="{Binding GradeWritingCommand}" 
                                       Margin="0,0,8,0"/>

                                    <!-- Send Button -->
                                    <!--<Button Style="{StaticResource SendButtonStyle}"
                                       Command="{Binding SendMessageCommand}">
                                        <TextBlock Text="➤" FontSize="12"/>
                                    </Button>-->
                                </StackPanel>
                            </Grid>
                        </Border>
                    </Grid>
                </TabItem>

                <!-- History Tab -->
                <TabItem Header="📚 Writing History" Style="{StaticResource ModernTabStyle}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- History Header -->
                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                            <Border Background="#FF10B981" CornerRadius="6" Width="24" Height="24" 
                               Margin="0,0,8,0">
                                <TextBlock Text="📊" FontSize="12" 
                                      HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="Your Writing Progress" FontSize="16" FontWeight="Bold" 
                                      Foreground="#FF1F2937"/>
                                <TextBlock Text="Review your submitted writings and feedback" 
                                      FontSize="11" Foreground="#FF6B7280"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- History List -->
                        <Border Grid.Row="1" Style="{StaticResource ModernCardStyle}">
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <StackPanel>
                                    <!-- History Items List -->
                                    <ItemsControl x:Name="HistoryItemsControl" ItemsSource="{Binding WritingHistoryList}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Style="{StaticResource HistoryItemStyle}" Cursor="Hand">
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto"/>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>

                                                        <!-- Date & Time -->
                                                        <StackPanel Grid.Column="0" Margin="0,0,10,0">
                                                            <TextBlock Text="{Binding SubmitDate, StringFormat='{}{0:MMM dd}'}" 
                                                                  FontSize="11" FontWeight="SemiBold" 
                                                                  Foreground="#FF1F2937"/>
                                                            <TextBlock Text="{Binding SubmitDate, StringFormat='{}{0:HH:mm}'}" 
                                                                  FontSize="10" 
                                                                  Foreground="#FF6B7280"/>
                                                        </StackPanel>

                                                        <!-- Writing Preview -->
                                                        <StackPanel Grid.Column="1">
                                                            <TextBlock Text="{Binding Text}" 
                                                                  FontSize="12" FontWeight="SemiBold" 
                                                                  Foreground="#FF1F2937" Margin="0,0,0,2"/>
                                                            <TextBlock Text="{Binding FeedBack}" 
                                                                  FontSize="11" Foreground="#FF6B7280" 
                                                                  TextTrimming="CharacterEllipsis" MaxWidth="300"
                                                                  MaxHeight="30" TextWrapping="Wrap"/>
                                                        </StackPanel>

                                                        <!-- Score -->
                                                        <!--
                                                        <Border Grid.Column="2" CornerRadius="8" 
                                                           Padding="6,3" Margin="0,0,8,0">
                                                            <Border.Style>
                                                                <Style TargetType="Border">
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding Score}" Value="High">
                                                                            <Setter Property="Background" Value="#FF10B981"/>
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding Score}" Value="Medium">
                                                                            <Setter Property="Background" Value="#FFF59E0B"/>
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding Score}" Value="Low">
                                                                            <Setter Property="Background" Value="#FFEF4444"/>
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </Border.Style>
                                                            <TextBlock Text="{Binding Score, StringFormat='{}{0:F1}/10'}" 
                                                                  FontSize="11" FontWeight="Bold" 
                                                                  Foreground="White"/>
                                                        </Border>-->

                                                        <!-- View Button -->
                                                        <Button Grid.Column="3" Content="View" 
                                                           Style="{StaticResource AttachButtonStyle}"
                                                           Width="Auto" Padding="8,4" FontSize="10"
                                                           Command="{Binding DataContext.ViewHistoryItemCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                                           CommandParameter="{Binding}"/>
                                                    </Grid>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </ScrollViewer>
                        </Border>

                        <!-- Statistics Summary -->
                        <Border Grid.Row="2" Background="#FF6366F1" CornerRadius="8" Padding="12" Margin="0,8,0,0"
                           Visibility="{Binding HasWritingHistory}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                                    <TextBlock Text="{Binding TotalWritings}" FontSize="18" FontWeight="Bold" 
                                          Foreground="White" HorizontalAlignment="Center"/>
                                    <TextBlock Text="Total Writings" FontSize="9" 
                                          Foreground="White" Opacity="0.8" 
                                          HorizontalAlignment="Center"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                                    <TextBlock Text="{Binding AverageScore, StringFormat='{}{0:F1}'}" FontSize="18" FontWeight="Bold" 
                                          Foreground="White" HorizontalAlignment="Center"/>
                                    <TextBlock Text="Average Score" FontSize="9" 
                                          Foreground="White" Opacity="0.8" 
                                          HorizontalAlignment="Center"/>
                                </StackPanel>

                                <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                                    <TextBlock Text="{Binding BestScore, StringFormat='{}{0:F1}'}" FontSize="18" FontWeight="Bold" 
                                          Foreground="White" HorizontalAlignment="Center"/>
                                    <TextBlock Text="Best Score" FontSize="9" 
                                          Foreground="White" Opacity="0.8" 
                                          HorizontalAlignment="Center"/>
                                </StackPanel>

                                <StackPanel Grid.Column="3" HorizontalAlignment="Center">
                                    <TextBlock FontSize="18" FontWeight="Bold" 
                                          HorizontalAlignment="Center">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding ScoreImprovement}" Value="True">
                                                        <Setter Property="Text" Value="{Binding ScoreImprovement, StringFormat='↗ +{0:F1}'}"/>
                                                        <Setter Property="Foreground" Value="#FF10B981"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding ScoreImprovement}" Value="True">
                                                        <Setter Property="Text" Value="{Binding ScoreImprovement, StringFormat='↘ {0:F1}'}"/>
                                                        <Setter Property="Foreground" Value="#FFEF4444"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding ScoreImprovement}" Value="0">
                                                        <Setter Property="Text" Value="→ 0.0"/>
                                                        <Setter Property="Foreground" Value="White"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                    <TextBlock Text="This Month" FontSize="9" 
                                          Foreground="White" Opacity="0.8" 
                                          HorizontalAlignment="Center"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </Grid>
                </TabItem>
            </TabControl>
        </Grid>
    </Grid>
</Page>